# Self-assigned Project – Game of Throne’s Social Network
**Christoffer Kramer**  
**26-05-2021**  
This self-assigned project builds on two of my previous portfolio entries: assignment 4 and assignment 6. This project uses network analysis to investigate how the social network in the television series Game of Thrones is structured. I’m using the data set from Assignment 6 in this project. I’m investigating how the social network changes over seasons, and how different characters, houses, and regions relate to each other. These results are then plotted according to their centralities (eigenvector, betweenness, and degree). I’m focusing the social network on, who is speaking about whom.  

## Methods
I’m using SpaCy’s named entity recognition to get the named characters on each line in the script and rule-based entity recognition (regexes) to find the speaker. Each character is then added as nodeB together with the speaker, who is nodeA, to an edgelist. This ensures that I’m getting a directed Graph where each edge only connects the speaker and the character that is being spoken about. The relationship between nodes is represented with an arrow leading from the speaker to the characters they are speaking about. 
I’m analyzing 4 different kinds of entities: first names, full names, house names, and region names. First names and full names are found using the previously mentioned method. House and region names are found with a combination of Spacy’s entity recognition and dictionary-based named entity recognition. This is done by using a CSV file of houses and regions to match the SpaCy entity’s last name with the corresponding house and region. The CSV file was generated by web scraping this webpage: https://awoiaf.westeros.org/index.php/List_of_Houses. 
I’m using networkx to calculate centralities and matplotlib to plot the networks.  

## Running on windows 
I have not been able to make my scripts work on windows. The problem is Pygraphviz. This library is not necessary to run the web scrape script, but you need it for the network analysis script. If you wish to use my scripts on a windows machine you should, therefore, create a virtual environment, install dependencies (requirements.txt and SpaCy’s en_core_web_sm NLP model), and then run the script manually from the src folder. However, installing pygraphviz can be a hassle, and you probably need to install that library (and its dependencies) manually.  

## Webscrape (webscrape.py)
**Usage:** This should work on both Linux and Mac. However, there is a chance that the website has been changed when you are reviewing this script. Therefore, the output CSV file is already included in the repo (it is located under the data folder and is called _houses_regions.csv_).  
_Step 1 - Clone repo:_  
```console
git clone https://github.com/Chris-Kramer/lang101_final_project.git
```
_Step 2 - Navigate to the assignment folder:_
```console
cd lang101_final_project
```  
_Step3 - Run bash script:_
```console
bash run-script-webscrape.sh
```  
### Output
The output is a CSV file called _houses_regions.csv_, which contains a list of every house in Westeros and what region that house is from.  

### Parameters  
This script doesn’t take parameters.

## Network analysis (calc_centrality.py)  
**Usage:** This should work on both Linux and Mac.  
_Once the repo is cloned and you have navigated to its folder, run the bash script “run-script-calc_centrality.sh”:_  
```console
bash run-script-calc_centrality.sh
```  
### Output
The output is 5 folders, which are located in the output folder. Each folder represents a network analysis of a season (except the folder “season_all_seasons”, which is a network analysis of all seasons). Each folder contains 4 subfolders (first_names, full_names, house_names, and region_names), which represent different named entities. Each of these subfolders contains the following files:  

- _season_X_betweenes_viz.png_: A visualization of the betweenness centralities in an undirected network for the season. Nodes are colored according to their centrality, and edges are colored according to their weight.  

- _season_X_degree _viz.png_: A visualization of the degree centralities in a directed network for the season. Nodes are colored according to their centrality, and edges are colored according to their weight.  

- _season_X_eigenvector _viz.png_: A visualization of the eigenvector centralities in a directed network for the season. Nodes are colored according to their centrality, and edges are colored according to their weight.  

- _season_X_centralities.csv_: A CSV file containing the centrality measures for each node in the season.   

### Parameters
The script takes the following parameters:  
- `--filter_a_full` Specify which edges to remove, based on their weight, for all seasons and full names.  
    - DEFAULT = 8  
- `--filter_a_first` Specify which edges to remove, based on their weight, for all seasons and first names.  
    - DEFAULT = 8  
- `--filter_s_full` Specify which edges to remove, based on their weight, for individual seasons and full names.  
    - DEFAULT = 2  
- `--filter_s_first` Specify which edges to remove, based on their weight, for individual seasons and first names.  
    - DEFAULT = 2  
- `--batch_size` The batch size for nlp pipe.  
    - DEFAULT = 200  

#### Example:
_With bash script:_  
```console
bash run-script-calc_centrality.sh --filter_a_full 10 --filter_a_first 10 --filter_s_full 4 --filter_s_first 4 --batch_size 150
```
_Without bash script:_
```console
python calc_centrality.py --filter_a_full 10 --filter_a_first 10 --filter_s_full 4 --filter_s_first 4 --batch_size 150
```  